{"H:\\deviceAssignment\\src\\service\\s3.ts":{"path":"H:\\deviceAssignment\\src\\service\\s3.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":82}},"2":{"start":{"line":4,"column":15},"end":{"line":4,"column":30}},"3":{"start":{"line":5,"column":17},"end":{"line":5,"column":34}},"4":{"start":{"line":6,"column":17},"end":{"line":6,"column":53}},"5":{"start":{"line":8,"column":0},"end":{"line":11,"column":62}},"6":{"start":{"line":9,"column":4},"end":{"line":9,"column":35}},"7":{"start":{"line":10,"column":4},"end":{"line":10,"column":35}},"8":{"start":{"line":12,"column":24},"end":{"line":17,"column":1}},"9":{"start":{"line":12,"column":50},"end":{"line":17,"column":1}},"10":{"start":{"line":13,"column":39},"end":{"line":13,"column":45}},"11":{"start":{"line":14,"column":16},"end":{"line":14,"column":47}},"12":{"start":{"line":15,"column":4},"end":{"line":15,"column":43}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":62}},"14":{"start":{"line":18,"column":0},"end":{"line":18,"column":42}},"15":{"start":{"line":19,"column":27},"end":{"line":30,"column":1}},"16":{"start":{"line":19,"column":53},"end":{"line":30,"column":1}},"17":{"start":{"line":20,"column":21},"end":{"line":20,"column":55}},"18":{"start":{"line":21,"column":15},"end":{"line":21,"column":31}},"19":{"start":{"line":22,"column":25},"end":{"line":28,"column":6}},"20":{"start":{"line":29,"column":4},"end":{"line":29,"column":24}},"21":{"start":{"line":31,"column":0},"end":{"line":31,"column":48}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":8,"column":1},"end":{"line":8,"column":2}},"loc":{"start":{"line":8,"column":22},"end":{"line":11,"column":1}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":24},"end":{"line":12,"column":25}},"loc":{"start":{"line":12,"column":50},"end":{"line":17,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":12,"column":50},"end":{"line":12,"column":51}},"loc":{"start":{"line":12,"column":65},"end":{"line":17,"column":1}},"line":12},"3":{"name":"(anonymous_3)","decl":{"start":{"line":19,"column":27},"end":{"line":19,"column":28}},"loc":{"start":{"line":19,"column":53},"end":{"line":30,"column":1}},"line":19},"4":{"name":"(anonymous_4)","decl":{"start":{"line":19,"column":53},"end":{"line":19,"column":54}},"loc":{"start":{"line":19,"column":80},"end":{"line":30,"column":1}},"line":19}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":15},"end":{"line":11,"column":60}},"type":"binary-expr","locations":[{"start":{"line":11,"column":15},"end":{"line":11,"column":32}},{"start":{"line":11,"column":37},"end":{"line":11,"column":59}}],"line":11}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1},"f":{"0":1,"1":1,"2":1,"3":1,"4":1},"b":{"0":[1,1]},"inputSourceMap":{"version":3,"file":"H:/deviceAssignment/src/service/s3.ts","sources":["H:/deviceAssignment/src/service/s3.ts"],"names":[],"mappings":";;;AACA,+BAAmC;AACnC,mCAA8C;AAE9C,sDAAoD;AAcpD,IAAY,SAGX;AAHD,WAAY,SAAS;IACnB,8BAAiB,CAAA;IACjB,8BAAiB,CAAA;AACnB,CAAC,EAHW,SAAS,GAAT,iBAAS,KAAT,iBAAS,QAGpB;AAGM,MAAM,eAAe,GAAG,CAAC,EAAE,QAAQ,EAAE,MAAM,EAAoC,EAAE,EAAE,CAAC,KAAK,EAAE,GAAW,EAA+B,EAAE;IAC5I,MAAM,EAAE,EAAE,EAAE,EAAE,MAAM,EAAE,MAAM,EAAE,EAAE,GAAG,MAAM,CAAA;IACzC,MAAM,GAAG,GAAG,IAAA,gBAAY,EAAC,QAAQ,CAAC,CAAA;IAClC,GAAG,CAAC,4BAA4B,EAAE,GAAG,CAAC,CAAA;IACtC,OAAO,QAAQ,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,OAAO,EAAE,CAAA;AAC3D,CAAC,CAAA;AALY,QAAA,eAAe,mBAK3B;AAEM,MAAM,kBAAkB,GAAG,CAAC,EAAE,QAAQ,EAAE,MAAM,EAAoC,EAAE,EAAE,CAAC,KAAK,EAAE,MAAiB,EAAE,OAAgB,EAAmB,EAAE;IAC3J,MAAM,QAAQ,GAAG,IAAA,aAAI,EAAC,KAAK,EAAE,OAAO,CAAC,CAAA;IACrC,MAAM,EAAE,GAAW,IAAA,SAAM,GAAE,CAAA;IAC3B,MAAM,YAAY,GAAW,MAAM,QAAQ,CAAC,YAAY,CAAC,MAAM,EAAE;QAC/D,MAAM,EAAE,IAAA,aAAI,EAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,EAAE,MAAM,CAAC;QACtC,GAAG,EAAE,GAAG,QAAQ,IAAI,EAAE,OAAO;QAC7B,OAAO,EAAE,IAAA,kBAAS,EAAC,GAAG,CAAC,CAAC,IAAA,aAAI,EAAC,SAAS,EAAE,OAAO,CAAC,CAAC;QACjD,WAAW,EAAE,kBAAkB;QAC/B,QAAQ,EAAE,OAAO,CAAC,QAAQ;KAC3B,CAAC,CAAA;IAEF,OAAO,YAAY,CAAA;AACrB,CAAC,CAAA;AAZY,QAAA,kBAAkB,sBAY9B","sourcesContent":["import { type S3 } from 'aws-sdk'\nimport { v4 as uuidv4 } from 'uuid'\nimport { defaultTo, prop, path } from 'rambda'\nimport { type Config } from '../config'\nimport createLogger from '../dependency/util/logger'\n\nexport type UrlBody = {\n  Bucket?: string;\n  Key: string;\n  Expires?: number;\n  Metadata?: Metadata;\n}\n\ntype Metadata = {\n  filename: string;\n  notification: any;\n}\n\nexport enum UrlMethod {\n  put = 'putObject',\n  get = 'getObject'\n}\n\n\nexport const createGetFromS3 = ({ s3Client, config }: { s3Client: S3, config: Config }) => async (key: string): Promise<S3.GetObjectOutput> => {\n  const { s3: { bucket: Bucket } } = config\n  const log = createLogger('S3:get')\n  log('Getting item from s3 using', key)\n  return s3Client.getObject({ Bucket, Key: key }).promise()\n}\n\nexport const createPresignedUrl = ({ s3Client, config }: { s3Client: S3, config: Config }) => async (method: UrlMethod, payload: UrlBody): Promise<string> => {\n  const filename = prop('Key', payload)\n  const id: string = uuidv4()\n  const presignedURL: string = await s3Client.getSignedUrl(method, {\n    Bucket: path(['s3', 'bucket'], config),\n    Key: `${filename}_${id}.json`, //filename\n    Expires: defaultTo(100)(prop('Expires', payload)),\n    ContentType: 'application/json',\n    Metadata: payload.Metadata\n  })\n\n  return presignedURL\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b081aab8988bbd5a46072b6400eb8a90043fbc5b","contentHash":"f4d2a49ca95f4876a7a463d44df3a71643f06f68e0d2a65d7810e2d4ace48e9b"},"H:\\deviceAssignment\\src\\dependency\\util\\logger.ts":{"path":"H:\\deviceAssignment\\src\\dependency\\util\\logger.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":16},"end":{"line":3,"column":32}},"2":{"start":{"line":4,"column":23},"end":{"line":4,"column":55}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":89}},"4":{"start":{"line":5,"column":31},"end":{"line":5,"column":88}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":18},"end":{"line":5,"column":19}},"loc":{"start":{"line":5,"column":31},"end":{"line":5,"column":88}},"line":5}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1},"f":{"0":1},"b":{},"inputSourceMap":{"version":3,"file":"H:/deviceAssignment/src/dependency/util/logger.ts","sources":["H:/deviceAssignment/src/dependency/util/logger.ts"],"names":[],"mappings":";;AAAA,iCAAyB;AACzB,wDAA+D;AAE/D,kBAAe,CAAC,OAAe,EAAE,EAAE,CAAC,IAAA,eAAK,EAAC,GAAG,mBAAe,IAAI,OAAO,EAAE,CAAC,CAAA","sourcesContent":["import debug from 'debug'\nimport { name as applicationName } from '../../../package.json'\n\nexport default (logName: string) => debug(`${applicationName}:${logName}`)\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f97d33c6fd792a0bc740a1513d61d7080323c1f8","contentHash":"1d7a7d882c99528d6181384952abfd785cb89f2fa2f198ddd0e3b57499cb31a7"},"H:\\deviceAssignment\\src\\config\\index.ts":{"path":"H:\\deviceAssignment\\src\\config\\index.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":24}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":34}},"3":{"start":{"line":5,"column":0},"end":{"line":41,"column":2}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1},"f":{},"b":{},"inputSourceMap":{"version":3,"file":"H:/deviceAssignment/src/config/index.ts","sources":["H:/deviceAssignment/src/config/index.ts"],"names":[],"mappings":";;;AAAA,mCAA+B;AAuClB,QAAA,MAAM,GAAW;IAC5B,GAAG,EAAE,OAAO,CAAC,GAAG,CAAC,GAAG;IACpB,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ;IAC9B,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,KAAK;IACxB,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,OAAO;IAC3B,OAAO,EAAE,OAAO,CAAC,GAAG,CAAC,OAAO;IAC5B,QAAQ,EAAE;QACR,cAAc,EAAE,IAAA,eAAM,EAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,wBAAwB,CAAC;QACpE,IAAI,EAAE;YACJ,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,sBAAsB;YAC5C,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,2BAA2B;YACpD,eAAe,EAAE,OAAO,CAAC,GAAG,CAAC,+BAA+B;YAC5D,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,oBAAoB;SACzC;QACD,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,mBAAmB;KACvC;IACD,EAAE,EAAE;QACF,IAAI,EAAE;YACJ,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,gBAAgB;YACtC,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,qBAAqB;YAC9C,eAAe,EAAE,OAAO,CAAC,GAAG,CAAC,yBAAyB;YACtD,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,cAAc;SACnC;QACD,gBAAgB,EAAE,IAAA,eAAM,EAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC;QACjE,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,cAAc;KACnC;IACD,GAAG,EAAE;QACH,IAAI,EAAE;YACJ,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,iBAAiB;YACvC,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,sBAAsB;YAC/C,eAAe,EAAE,OAAO,CAAC,GAAG,CAAC,0BAA0B;YACvD,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,eAAe;SACpC;QACD,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,SAAS;QAC5B,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,aAAa;KACpC;CACF,CAAA","sourcesContent":["import { equals } from 'rambda'\n\ntype AWSPARAMS = {\n    endpoint: string;\n    accessKeyId: string;\n    secretAccessKey: string;\n    region: string;\n}\n\ntype DynamoConfig = {\n  seedingEnabled: boolean;\n  auth: AWSPARAMS\n  table: string;\n}\n\ntype SnsConfig = {\n  auth: AWSPARAMS\n  topic: string;\n  topicArn: string;\n}\n\ntype S3Config = {\n  s3ForcePathStyle: boolean;\n  bucket: string;\n  auth: AWSPARAMS\n}\n\nexport interface Config {\n  env: string;\n  endpoint: string;\n  debug: string;\n  apiKey: string;\n  version: string;\n  dynamodb: DynamoConfig;\n  s3: S3Config;\n  sns: SnsConfig;\n}\n\n// App configuration\nexport const config: Config = {\n  env: process.env.ENV,\n  endpoint: process.env.ENDPOINT,\n  debug: process.env.DEBUG,\n  apiKey: process.env.API_KEY,\n  version: process.env.VERSION,\n  dynamodb: {\n    seedingEnabled: equals('true', process.env.DYNAMODB_SEEDING_ENABLED),\n    auth: {\n      endpoint: process.env.DYNAMODB_AUTH_ENDPOINT,\n      accessKeyId: process.env.DYNAMODB_AUTH_ACCESS_KEY_ID,\n      secretAccessKey: process.env.DYNAMODB_AUTH_SECRET_ACCESS_KEY,\n      region: process.env.DYNAMODB_AUTH_REGION,\n    },\n    table: process.env.DYNAMODB_AUTH_TABLE\n  },\n  s3: {\n    auth: {\n      endpoint: process.env.S3_AUTH_ENDPOINT,\n      accessKeyId: process.env.S3_AUTH_ACCESS_KEY_ID,\n      secretAccessKey: process.env.S3_AUTH_SECRET_ACCESS_KEY,\n      region: process.env.S3_AUTH_REGION\n    },\n    s3ForcePathStyle: equals('true', process.env.S3_FORCE_PATH_STYLE),\n    bucket: process.env.S3_BUCKET_NAME\n  },\n  sns: {\n    auth: {\n      endpoint: process.env.SNS_AUTH_ENDPOINT,\n      accessKeyId: process.env.SNS_AUTH_ACCESS_KEY_ID,\n      secretAccessKey: process.env.SNS_AUTH_SECRET_ACCESS_KEY,\n      region: process.env.SNS_AUTH_REGION\n    },\n    topic: process.env.SNS_TOPIC,\n    topicArn: process.env.SNS_TOPIC_ARN\n  },\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"63c8ddc6137542fcd7ad7ab59776d5d83dbff7e1","contentHash":"74aa5341c690e897a6d8a49db7c22b1901015459fe7f62afddd58cf6fcc732e7"}}